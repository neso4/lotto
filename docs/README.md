
- [기능 목록](#기능-목록)
  - [1. 당첨번호 뽑기](#1-당첨번호-뽑기)
    - [사용자 입력받기](#사용자-입력받기)
    - [당첨번호 입력받기](#당첨번호-입력받기)
  - [2. 당첨 여부 체크하기](#2-당첨여부-체크하기)
  - [3. 결과 출력하기](#3-결과-출력하기)
- [테스트 작성](#테스트-작성)
  - [기능 테스트](#기능-테스트)
  - [검증 테스트](#검증-테스트)
- [고민 사항](#고민사항)
  - [LotteryGame 클래스가 사용하는 객체를 어떻게 주입할 것인가?](#lotterygame-클래스가-사용하는-객체를-어떻게-주입할-것인가)
  - [상수 관련 클래스를 어느 곳에 위치시킬 것인가?](#상수-관련-클래스를-어느곳에-위치시켜야하는가)
  - [점검 메서드의 중복된 로직](#점검-메서드의-중복된-로직)
  - [어떻게 `else` 키워드에서 탈출할 수 있는가?](#어떻게-else-키워드에서-탈출할-수-있는가)

---

# 기능 목록

## 1. 당첨번호 뽑기

### 사용자 입력받기
- [x] 사용자로부터 로또 구입 금액을 입력받는다.
- [x] 1,000원 단위로 입력받는다.
- [x] 사용자가 구매한 로또 번호를 오름차순으로 배열로 보여준다.
    ```
  [8, 21, 23, 41, 42, 43] 
    [3, 5, 11, 16, 32, 38]
    [7, 11, 16, 35, 36, 44]
    [1, 8, 11, 31, 41, 42]
    [13, 14, 16, 38, 42, 45]
    [7, 11, 30, 40, 42, 43]
    [2, 13, 22, 32, 38, 45]
    [1, 3, 5, 14, 22, 45]
    ```
- [x] 입력데이터 검증하기
  - [x] 1,000원 단위가 아닐 때 잘못된 입력으로 간주하고 `IllegalArgumentException`을 던진다.
  - [x] 숫자로 변환할 수 없는 문자를 입력받았을 때, `IllegalArgumentException`을 던진다.

### 당첨번호 입력받기
- [x] 쉼표로 구분된 당첨번호를 입력받는다.
- [x] 보너스 번호를 입력받는다.
- [x] 데이터 검증하기
  - [x] 로또 숫자 입력 형식을 지켰는가?
  - [x] 당첨번호, 보너스 번호가 지정된 범위안에 속하는가?
  - [x] 당첨번호, 보너스 번호가 양의 정수인가?

## 2. 당첨여부 체크하기
- [x] 사용자가 뽑은 복권의 번호들과 당첨 복권의 번호를 비교한다.
- [x] 맞춘 당첨번호의 수 + 맞춘 보너스 번호의 수를 조합으로 당첨 여부를 체크한다.

## 3. 결과 출력하기
- [x] 당첨 통계를 출력한다.
- [x] 결과를 담은 객체의 `toString` 메서드를 오버라이딩하자.

# 테스트 작성
## 기능 테스트
- MerchantTest
  - 상인에게 돈을 건내주면 그에 맞는 갯수의 복권을 반환하는지
- LotteryResultTest
  - 일치하는 당첨번호 갯수 + 일치하는 보너스 번호 갯수의 조합으로 맞는 LotteryResult 가 반환되는가?
  - 각 LotteryResult로 가격정보를 조회했을 때 올바른 가격이 조회되는가?
- LuckyTicketTest
  - 사용자의 복권과 당첨복권을 매칭했을 때 그 결과가 올바르게 출력되는가?
## 검증 테스트
- LotteryMachineValidatorTest
  - 당첨 번호가 정해진 갯수로 구분되지 않을 때 예외가 발생하는가?
  - 당첨 번호가 정수가 아닌 값이 있을 때 예외가 발생하는가?
  - 당첨 번호가 범위를 벗어날 때 예외가 발생하는가?
  - 보너스 번호가 정수가 아닐 때 예외가 발생하는가?
  - 보너스 번호가 이미 당첨번호에 존재할 때 예외가 발생하는가?
  - 보너스 번호가 범위를 벗어났을 때 예외가 발생하는가?
- UserTicketValidatorTest
  - 티켓 가격이 정수가 아닐 때 예외가 발생하는가?
  - 티켓 가격이 1000의 배수가 아닐 때 예외가 발생하는가?
  - 티켓의 갯수가 0이하가 될 때 예외가 발생하는가?

# 고민사항
### LotteryGame 클래스가 사용하는 객체를 어떻게 주입할 것인가?
`LotteryGame` 클래스는 유저가 복권을 구매하는 대상인 `Merchant` 클래스와 당첨번호와 보너스 번호를 뽑는 `LotteryMachine` 클래스에 의존하고 있다.
Application클래스에서 LotteryGame 클래스를 생성할 때 이 두가지 객체를 주입해 주기로 했다. 이 두가지 설정정보는 ApplicationConfig 라는 곳에서 반환하기 
때문에 추후에 구현체를 바꾸고 싶다면 이 클래스만 수정하면 된다.

### 상수 관련 클래스를 어느곳에 위치시켜야하는가?
처음에는 에러 메세지, 애플리케이션에서 사용되는 정수 값등을 애플리케이션 전체에서 사용되는 상수라고 생각해
모든 상수를 하나의 클래스에 위치시켰다. 그러나, 개발중 상수 클래스를 보았을 때 이 상수가 정확히 어느 클래스에서 사용되는 것인지
파악하기 어려워졌다. 그래서 상수 값들을 하나의 클래스에 모아두기 보다는 직접 사용되는 곳에 위치시키는 것이 적절하다고 판단했다.

### 점검 메서드의 중복된 로직
사용자의 구매 가격을 입력받거나, 당첨 번호를 입력받을 때 등 입력을 받을 때마다 올바른 데이터인지 검증하는 과정을 거친다. 그런데 검증하는 것에는
`입력받은 내용이 정수인가?` 또는 `입력 받은 것의 범위가 일치하는가?`등 중복되는 검증 내용이 존재한다. 그래서 처음에는 중복을 줄이고 
[TypeMismatchValidator](../src/main/java/lotto/validator/TypeMismatchValidator.java), 
[RangeValidator](../src/main/java/lotto/validator/RangeValidator.java) 
등 관련된 내용을 검증할 수 있는 클래스를 만들었다. 하지만 이런 방법을 사용하면 실제로 잘못된 입력을 예외메세지를 보고 어디서 문제가 발생했는지 파악하기 
어렵다는 문제점이 발생했다. 메세지를 그대로 전달할 수도 있지만 그렇게 되면 종류별로 메세지를 만들어주는 메서드를 각 클래스마다 작성해주어야 한다는 점도 
불편함으로 다가왔다.

그래서 검증 로직이 중복된다고 해도 검사를 하고, 예외가 발생한 클래스만 보고도 어느 부분에서 문제가 발생했는지 알수 있도록 구현하였다.

### 어떻게 `else` 키워드에서 탈출할 수 있는가?
`if-else` 구문을 사용해서 경우를 구분하고 분기문을 사용하는 경우에는 미래에 고려해야하는 경우의 값이 많아지게 되면 `if-else` 키워드를 사용한 분기문또한 끝없이 길어지는 문제가 있다. 이때는 한정된 값들을 담은 `Enum`을 정의하고 연관된 값들을 필드로 가지게 함으로써 해결할 수 있다. 그러면 나중에 추가되는 사항이 있을 때 이 Enum만 수정하면 되고, 원하는 데이터를 찾아오는 것은 메서드에 찾고자하는 대상을 파라미터로 넘겨주는 것만으로 가능하다.

이번 미션에서 유저가 가지고 있는 복권의 번호와 당첨 복권의 숫자가 일치하는 갯수와 보너스 번호가 일치하는 갯수로 복권결과의 상태를 구분했다. 

- 일치하는 당첨번호가 6개, 보너스번호가 0개이면 1등
- 일치하는 당첨번호가 3개, 보너스번호가 0개이면 5등

이러한 방식이다.

그래서 LotteryResult라는 열거형을 정의하고, 그곳에서 일치한 당첨번호의 개수, 보너스 번호의 개수를 연관값으로 가지도록 하였다. 그리고 이 정보를 이용해서 일치하는 상태값을 반환받을 수 있도록 메서드를 정의했다.
```java
public static LotteryResult getWinnerMoneyOf(int count, int bonus) throws IllegalStateException {
    Optional<LotteryResult> lotteryResult = Arrays.stream(LotteryResult.values())
        .filter(result -> result.count == count && result.bonus == bonus)
        .findAny();

    if (!lotteryResult.isPresent()) {
        return NOTHING;
    }

    return lotteryResult.orElseThrow(
        () -> new IllegalStateException("존재하지 않는 결과입니다. 당첨번호, 보너스 번호 갯수를 다시 확인해주세요.")
    );
}
```
